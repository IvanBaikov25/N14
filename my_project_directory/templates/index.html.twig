<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title> Админка — еда в деле!</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; }
        section { margin-bottom: 40px; }
        h2 { color: #d32f2f; }
        form { background: #f9f9f9; padding: 15px; border-radius: 5px; margin: 15px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 8px 12px; text-align: left; }
        th { background: #eee; }
        .error { color: red; margin: 10px 0; }
    </style>
</head>
<body>

<h1> Админка — всё под рукой</h1>

{% if errors %}
    <div class="error">
        {% for error in errors %}• {{ error }}<br>{% endfor %}
    </div>
{% endif %}

<!-- КЛИЕНТЫ -->
<section>
    <h2> Клиенты</h2>
    <form method="POST">
        <input type="text" name="client_name" placeholder="Имя *" required> 
        <input type="text" name="client_phone" placeholder="Телефон *" required>
        <button type="submit" name="add_client">➕ Добавить</button>
    </form>

    <table>
        <tr><th>ID</th><th>Имя</th><th>Телефон</th></tr>
        {% for c in clients %}
            <tr><td>{{ c.id }}</td><td>{{ c.name }}</td><td>{{ c.phone }}</td></tr>
        {% else %}
            <tr><td colspan="3">— нет клиентов —</td></tr>
        {% endfor %}
    </table>
</section>

<!-- БЛЮДА -->
<section>
    <h2> Блюда</h2>
    <form method="POST">
        <input type="text" name="dish_name" placeholder="Название *" required>
        <input type="number" step="0.01" name="dish_price" placeholder="Цена (>0) *" required min="0.01">
        <button type="submit" name="add_dish">➕ Добавить</button>
    </form>

    <table>
        <tr><th>ID</th><th>Название</th><th>Цена</th></tr>
        {% for d in dishes %}
            <tr><td>{{ d.id }}</td><td>{{ d.name }}</td><td>{{ d.price }} ₽</td></tr>
        {% else %}
            <tr><td colspan="3">— нет блюд —</td></tr>
        {% endfor %}
    </table>
</section>

<!-- ЗАКАЗЫ -->
<section>
    <h2> Заказы</h2>
    <form method="POST">
        <label>Клиент:</label>
        <select name="order_client" required>
            <option value="">— выберите —</option>
            {% for c in clients %}
                <option value="{{ c.id }}">{{ c.name }}</option>
            {% endfor %}
        </select>

        <br><br><label>Блюда (≥1):</label><br>
        {% for d in dishes %}
            <label>
                <input type="checkbox" name="order_dishes[]" value="{{ d.id }}">
                {{ d.name }} ({{ d.price }} ₽)
            </label><br>
        {% else %}
            <em>— сначала добавьте блюда —</em>
        {% endfor %}

        <br><br>
        <button type="submit" name="add_order"
            {% if not clients or not dishes %} disabled {% endif %}>
            Создать заказ
        </button>
    </form>

    <table>
        <tr><th>ID</th><th>Клиент</th><th>Блюда</th><th>Время</th></tr>
        {% for o in orders %}
            <tr>
                <td>{{ o.id }}</td>
                <td>{{ o.client.name }}</td>
                <td>
                    {% for dish in o.dishes %}
                        {{ dish.name }} ({{ dish.price }} ₽)<br>
                    {% endfor %}
                </td>
                <td>{{ o.createdAt|date('H:i d/m') }}</td>
            </tr>
        {% else %}
            <tr><td colspan="4">— нет заказов —</td></tr>
        {% endfor %}
    </table>
</section>

</body>
</html>